//
//  LidarDataSource.swift
//  LidarDemo
//
//  Created by Peter Richardson on 9/3/24.
//

import Foundation

struct sl_lidar_response_measurement_node_hq {

    let angle_z_q14 : UInt16    // fixed-point angle in z presentation
    let dist_mm_q2 : UInt32     // Distance in millimeter of fixed point values
    let quality : UInt8         // Measurement quality (0 ~ 255)
    let flag : UInt8            // Flags, current only one bit used: SL_LIDAR_RESP_MEASUREMENT_SYNCBIT
    
    // float angle_in_degrees = angle_z_q14 * 90.f / (1 << 14);
    var angle: CGFloat {
        get {
            CGFloat(angle_z_q14) * 90.0 / CGFloat(1 << 14)
        }
    }
    
    // float distance_in_meters = node.dist_mm_q2 / 1000.f / (1 << 2);
    var dist: CGFloat {
        get {
            //CGFloat(dist_mm_q2) / 1000.0 / CGFloat(1 << 2)
            CGFloat(dist_mm_q2) / CGFloat(1 << 2)
        }
    }
    
    init(angle_z_q14: UInt16, dist_mm_q2: UInt32, quality: UInt8, flag: UInt8) {
        self.angle_z_q14 = angle_z_q14
        self.dist_mm_q2 = dist_mm_q2
        self.quality = quality
        self.flag = flag
    }
    
    init(_ angle: CGFloat, _ dist_mm_q2: UInt32, _ quality: UInt8, _ flag: UInt8) {
        self.angle_z_q14 = UInt16(angle * CGFloat(1 << 14) / 90.0)
        self.dist_mm_q2 = dist_mm_q2
        self.quality = quality
        self.flag = flag
    }
}
typealias LidarNode = sl_lidar_response_measurement_node_hq
typealias Lidar360Data = [LidarNode]

let sample360Data : Lidar360Data = [
        LidarNode(0.06,     226,188,0),
        LidarNode(0.89,     227,188,0),
        LidarNode(1.71,     226,188,0),
        LidarNode(2.54,     225,188,0),
        LidarNode(5.02,     224,188,0),
        LidarNode(5.84,     225,188,0),
        LidarNode(6.67,     228,188,0),
        LidarNode(7.50,     227,188,0),
        LidarNode(8.33,     226,188,0),
        LidarNode(9.15,     227,188,0),
        LidarNode(9.98,     228,188,0),
        LidarNode(10.81,     230,188,0),
        LidarNode(11.64,     230,188,0),
        LidarNode(12.46,     229,188,0),
        LidarNode(13.29,     230,188,0),
        LidarNode(14.12,     231,188,0),
        LidarNode(14.95,     231,188,0),
        LidarNode(15.77,     230,188,0),
        LidarNode(16.59,     233,188,0),
        LidarNode(17.42,     236,188,0),
        LidarNode(18.25,     238,188,0),
        LidarNode(19.08,     237,188,0),
        LidarNode(19.90,     237,188,0),
        LidarNode(20.73,     239,188,0),
        LidarNode(21.56,     239,188,0),
        LidarNode(22.39,     241,188,0),
        LidarNode(23.21,     245,188,0),
        LidarNode(24.04,     246,188,0),
        LidarNode(24.87,     246,188,0),
        LidarNode(25.70,     247,188,0),
        LidarNode(26.53,     248,188,0),
        LidarNode(27.34,     252,188,0),
        LidarNode(28.17,     256,188,0),
        LidarNode(28.98,     260,188,0),
        LidarNode(29.81,     263,188,0),
        LidarNode(30.62,     261,188,0),
        LidarNode(31.45,     264,188,0),
        LidarNode(32.26,     268,188,0),
        LidarNode(33.09,     270,188,0),
        LidarNode(33.90,     275,188,0),
        LidarNode(34.73,     275,188,0),
        LidarNode(35.56,     274,188,0),
        LidarNode(36.37,     279,188,0),
        LidarNode(37.20,     283,188,0),
        LidarNode(38.01,     288,188,0),
        LidarNode(38.84,     288,188,0),
        LidarNode(41.29,     620,188,0),
        LidarNode(42.12,     627,188,0),
        LidarNode(42.93,     632,188,0),
        LidarNode(43.76,     638,188,0),
        LidarNode(44.59,     651,188,0),
        LidarNode(45.40,     657,188,0),
        LidarNode(48.69,     234,188,0),
        LidarNode(49.52,     235,188,0),
        LidarNode(50.32,     233,188,0),
        LidarNode(51.15,     229,188,0),
        LidarNode(51.98,     228,188,0),
        LidarNode(52.79,     227,188,0),
        LidarNode(53.62,     223,188,0),
        LidarNode(54.44,     224,188,0),
        LidarNode(56.07,     250,188,0),
        LidarNode(56.90,     250,188,0),
        LidarNode(57.72,     251,188,0),
        LidarNode(61.81,     900,188,0),
        LidarNode(62.62,     893,188,0),
        LidarNode(64.25,     987,188,0),
        LidarNode(65.06,    1012,188,0),
        LidarNode(65.89,    1035,188,0),
        LidarNode(67.51,     455,188,0),
        LidarNode(69.14,     552,188,0),
        LidarNode(72.41,     541,188,0),
        LidarNode(73.22,     539,188,0),
        LidarNode(74.03,     540,188,0),
        LidarNode(74.84,     536,188,0),
        LidarNode(75.65,     533,188,0),
        LidarNode(76.46,     531,188,0),
        LidarNode(77.28,     528,188,0),
        LidarNode(78.09,     525,188,0),
        LidarNode(78.92,     522,188,0),
        LidarNode(79.73,     519,188,0),
        LidarNode(80.55,     517,188,0),
        LidarNode(81.36,     513,188,0),
        LidarNode(82.17,     508,188,0),
        LidarNode(85.44,     686,188,0),
        LidarNode(86.25,     687,188,0),
        LidarNode(87.06,     687,188,0),
        LidarNode(87.87,     683,188,0),
        LidarNode(93.56,    1144,188,0),
        LidarNode(94.37,    1134,188,0),
        LidarNode(95.19,    1139,188,0),
        LidarNode(96.00,    1141,188,0),
        LidarNode(96.81,    1142,188,0),
        LidarNode(97.61,    1143,188,0),
        LidarNode(98.42,    1143,188,0),
        LidarNode(99.23,    1142,188,0),
        LidarNode(102.48,     569,188,0),
        LidarNode(105.72,     567,188,0),
        LidarNode(107.34,     551,188,0),
        LidarNode(108.14,     558,188,0),
        LidarNode(110.58,     556,188,0),
        LidarNode(113.01,     573,188,0),
        LidarNode(117.87,    1230,188,0),
        LidarNode(120.29,    1252,188,0),
        LidarNode(121.11,    1258,188,0),
        LidarNode(123.55,    1111,188,0),
        LidarNode(125.98,    1332,188,0),
        LidarNode(129.25,     848,188,0),
        LidarNode(134.14,     843,188,0),
        LidarNode(134.95,     850,188,0),
        LidarNode(138.21,     921,188,0),
        LidarNode(140.67,    1105,188,0),
        LidarNode(148.83,    1292,188,0),
        LidarNode(149.64,    1302,188,0),
        LidarNode(151.28,    2134,188,0),
        LidarNode(152.09,    2176,188,0),
        LidarNode(152.90,    2229,188,0),
        LidarNode(153.73,    2285,188,0),
        LidarNode(154.54,    2344,188,0),
        LidarNode(155.36,    2405,188,0),
        LidarNode(156.17,    2473,188,0),
        LidarNode(156.99,    2539,188,0),
        LidarNode(158.60,    2310,188,0),
        LidarNode(161.84,    2988,188,0),
        LidarNode(162.65,    3027,188,0),
        LidarNode(164.26,    3223,188,0),
        LidarNode(168.31,     173,188,0),
        LidarNode(169.12,     173,188,0),
        LidarNode(169.94,     173,188,0),
        LidarNode(170.73,     172,188,0),
        LidarNode(171.55,     172,188,0),
        LidarNode(172.36,     171,188,0),
        LidarNode(173.17,     170,188,0),
        LidarNode(173.97,     169,188,0),
        LidarNode(174.78,     169,188,0),
        LidarNode(175.59,     167,188,0),
        LidarNode(176.40,     165,188,0),
        LidarNode(177.20,     166,188,0),
        LidarNode(178.01,     165,188,0),
        LidarNode(178.82,     164,188,0),
        LidarNode(179.64,     163,188,0),
        LidarNode(180.43,     162,188,0),
        LidarNode(181.25,     162,188,0),
        LidarNode(182.06,     162,188,0),
        LidarNode(182.87,     161,188,0),
        LidarNode(183.67,     161,188,0),
        LidarNode(184.48,     162,188,0),
        LidarNode(185.30,     162,188,0),
        LidarNode(186.11,     161,188,0),
        LidarNode(186.90,     160,188,0),
        LidarNode(187.72,     161,188,0),
        LidarNode(188.53,     160,188,0),
        LidarNode(189.34,     160,188,0),
        LidarNode(190.14,     161,188,0),
        LidarNode(190.95,     160,188,0),
        LidarNode(191.76,     161,188,0),
        LidarNode(192.57,     161,188,0),
        LidarNode(193.37,     162,188,0),
        LidarNode(194.18,     163,188,0),
        LidarNode(195.00,     164,188,0),
        LidarNode(195.81,     165,188,0),
        LidarNode(196.61,     166,188,0),
        LidarNode(197.42,     168,188,0),
        LidarNode(198.23,     169,188,0),
        LidarNode(199.04,     172,188,0),
        LidarNode(199.86,     175,188,0),
        LidarNode(200.65,     175,188,0),
        LidarNode(201.47,     178,188,0),
        LidarNode(202.28,     180,188,0),
        LidarNode(203.09,     183,188,0),
        LidarNode(203.89,     186,188,0),
        LidarNode(204.70,     190,188,0),
        LidarNode(206.32,     202,188,0),
        LidarNode(207.14,     198,188,0),
        LidarNode(208.75,     251,188,0),
        LidarNode(209.56,     254,188,0),
        LidarNode(210.37,     257,188,0),
        LidarNode(211.17,     260,188,0),
        LidarNode(211.98,     262,188,0),
        LidarNode(212.79,     266,188,0),
        LidarNode(213.61,     274,188,0),
        LidarNode(214.42,     281,188,0),
        LidarNode(215.22,     285,188,0),
        LidarNode(216.03,     287,188,0),
        LidarNode(216.84,     289,188,0),
        LidarNode(218.45,     302,188,0),
        LidarNode(220.08,     334,188,0),
        LidarNode(221.70,     317,188,0),
        LidarNode(223.28,     302,188,0),
        LidarNode(224.08,     302,188,0),
        LidarNode(225.67,     278,188,0),
        LidarNode(226.47,     275,188,0),
        LidarNode(232.03,    2180,188,0),
        LidarNode(232.81,    2157,188,0),
        LidarNode(233.61,    2135,188,0),
        LidarNode(234.40,    2112,188,0),
        LidarNode(235.20,    2086,188,0),
        LidarNode(236.00,    2063,188,0),
        LidarNode(236.79,    2038,188,0),
        LidarNode(237.57,    2006,188,0),
        LidarNode(238.37,    1981,188,0),
        LidarNode(239.96,    1655,188,0),
        LidarNode(240.77,    1647,188,0),
        LidarNode(241.56,    1639,188,0),
        LidarNode(242.36,    1628,188,0),
        LidarNode(243.14,    1616,188,0),
        LidarNode(245.53,    1241,188,0),
        LidarNode(246.32,    1230,188,0),
        LidarNode(247.12,    1219,188,0),
        LidarNode(247.92,    1207,188,0),
        LidarNode(248.70,    1204,188,0),
        LidarNode(249.50,    1217,188,0),
        LidarNode(250.30,    1244,188,0),
        LidarNode(251.09,    1275,188,0),
        LidarNode(251.89,    1303,188,0),
        LidarNode(252.69,    1319,188,0),
        LidarNode(254.26,    1378,188,0),
        LidarNode(255.86,     443,188,0),
        LidarNode(256.65,     442,188,0),
        LidarNode(257.45,     445,188,0),
        LidarNode(258.24,     448,188,0),
        LidarNode(259.05,     448,188,0),
        LidarNode(259.84,     449,188,0),
        LidarNode(260.64,     450,188,0),
        LidarNode(261.44,     451,188,0),
        LidarNode(262.23,     451,188,0),
        LidarNode(263.03,     451,188,0),
        LidarNode(263.83,     452,188,0),
        LidarNode(264.61,     452,188,0),
        LidarNode(265.40,     452,188,0),
        LidarNode(266.20,     451,188,0),
        LidarNode(267.00,     452,188,0),
        LidarNode(267.79,     452,188,0),
        LidarNode(268.59,     451,188,0),
        LidarNode(269.39,     451,188,0),
        LidarNode(270.19,     453,188,0),
        LidarNode(270.98,     454,188,0),
        LidarNode(271.78,     455,188,0),
        LidarNode(272.58,     457,188,0),
        LidarNode(273.37,     458,188,0),
        LidarNode(274.17,     459,188,0),
        LidarNode(274.95,     460,188,0),
        LidarNode(275.75,     462,188,0),
        LidarNode(276.54,     465,188,0),
        LidarNode(277.34,     468,188,0),
        LidarNode(278.14,     470,188,0),
        LidarNode(278.94,     471,188,0),
        LidarNode(279.73,     472,188,0),
        LidarNode(280.53,     475,188,0),
        LidarNode(281.33,     478,188,0),
        LidarNode(282.12,     480,188,0),
        LidarNode(282.92,     481,188,0),
        LidarNode(283.72,     480,188,0),
        LidarNode(287.67,     566,188,0),
        LidarNode(288.47,     562,188,0),
        LidarNode(289.25,     562,188,0),
        LidarNode(290.04,     562,188,0),
        LidarNode(290.84,     564,188,0),
        LidarNode(291.62,     568,188,0),
        LidarNode(294.78,     821,188,0),
        LidarNode(296.37,     551,188,0),
        LidarNode(297.15,     540,188,0),
        LidarNode(297.95,     535,188,0),
        LidarNode(299.53,     489,188,0),
        LidarNode(300.31,     476,188,0),
        LidarNode(301.11,     468,188,0),
        LidarNode(301.90,     467,188,0),
        LidarNode(304.26,     470,188,0),
        LidarNode(305.06,     471,188,0),
        LidarNode(305.84,     481,188,0),
        LidarNode(307.44,     528,188,0),
        LidarNode(308.22,     516,188,0),
        LidarNode(309.01,     508,188,0),
        LidarNode(309.79,     505,188,0),
        LidarNode(310.59,     504,188,0),
        LidarNode(311.37,     505,188,0),
        LidarNode(313.75,     570,188,0),
        LidarNode(314.54,     573,188,0),
        LidarNode(315.32,     569,188,0),
        LidarNode(316.12,     560,188,0),
        LidarNode(316.92,     551,188,0),
        LidarNode(317.70,     541,188,0),
        LidarNode(318.48,     538,188,0),
        LidarNode(320.06,     333,188,0),
        LidarNode(320.86,     333,188,0),
        LidarNode(321.64,     329,188,0),
        LidarNode(322.43,     323,188,0),
        LidarNode(323.22,     322,188,0),
        LidarNode(324.01,     320,188,0),
        LidarNode(324.79,     317,188,0),
        LidarNode(326.37,     303,188,0),
        LidarNode(327.17,     304,188,0),
        LidarNode(327.95,     299,188,0),
        LidarNode(328.75,     298,188,0),
        LidarNode(330.33,     291,188,0),
        LidarNode(331.11,     289,188,0),
        LidarNode(331.90,     286,188,0),
        LidarNode(332.68,     283,188,0),
        LidarNode(333.47,     277,188,0),
        LidarNode(334.26,     271,188,0),
        LidarNode(335.04,     269,188,0),
        LidarNode(335.84,     269,188,0),
        LidarNode(336.62,     267,188,0),
        LidarNode(337.42,     268,188,0),
        LidarNode(338.20,     269,188,0),
        LidarNode(339.78,     255,188,0),
        LidarNode(340.58,     253,188,0),
        LidarNode(341.36,     252,188,0),
        LidarNode(343.73,     247,188,0),
        LidarNode(344.51,     243,188,0),
        LidarNode(345.31,     244,188,0),
        LidarNode(346.09,     245,188,0),
        LidarNode(346.89,     244,188,0),
        LidarNode(347.67,     240,188,0),
        LidarNode(348.46,     238,188,0),
        LidarNode(349.25,     237,188,0),
        LidarNode(350.03,     233,188,0),
        LidarNode(350.83,     232,188,0),
        LidarNode(351.61,     231,188,0),
        LidarNode(352.40,     234,188,0),
        LidarNode(353.18,     235,188,0),
        LidarNode(353.98,     232,188,0),
        LidarNode(354.77,     229,188,0),
        LidarNode(355.56,     229,188,0),
        LidarNode(356.34,     230,188,0),
        LidarNode(357.12,     228,188,0),
        LidarNode(357.92,     225,188,0),
        LidarNode(358.70,     226,188,0),
        LidarNode(359.23,     225,188,0),
    ]
